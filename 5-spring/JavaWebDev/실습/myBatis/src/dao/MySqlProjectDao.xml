<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<mapper namespace="dao.ProjectDao">
		<resultMap type="project" id="projectResultMap">
			<id column="id" property="id"/>
			<result column="title" property="title"/>
			<result column="contents" property="contents"/>
			<result column="start" property="start" javaType="java.sql.Date"/>
			<result column="end" property="end" javaType="java.sql.Date"/>
			<result column="state" property="state"/>
			<result column="created_at" property="createdAt" javaType="java.sql.Date"/>
			<result column="tags" property="tags"/>
		</resultMap>
		
		<select id="selectList" parameterType="map" resultMap="projectResultMap">
			select id, title, start, end, state
			from projects
			order by 
			<choose>
				<when test="orderCond == 'TITLE_ASC'">title ASC</when>
				<when test="orderCond == 'TITLE_DESC'">title DESC</when>
				<when test="orderCond == 'START_ASC'">start ASC</when>
				<when test="orderCond == 'START_DESC'">start DESC</when>
				<when test="orderCond == 'ENDDATE_ASC'">end ASC</when>
				<when test="orderCond == 'ENDDATE_DESC'">end DESC</when>
				<when test="orderCond == 'STATE_ASC'">state ASC</when>
				<when test="orderCond == 'STATE_DESC'">state DESC</when>
				<when test="orderCond == 'PNO_ASC'">id ASC</when>
				<otherwise>id DESC</otherwise>
			</choose>
		</select>
		
		<insert id="insert" parameterType="project">
			insert into projects(id, title, contents, start, end, state, created_at, tags)
			values (null, #{title}, #{contents}, #{start}, #{end}, 0, now(), #{tags})
		</insert>
		
		<select id="selectOne" parameterType="int" resultMap="projectResultMap">
			select id, title, contents, start, end, state, created_at, tags
			from projects
			where id=#{value}
		</select>
		
		<update id="update" parameterType="map">
			update projects
			<set>
				<if test="title != null">title=#{title},</if>
				<if test="contents != null">contents=#{contents},</if>
				<if test="start != null">start=#{start},</if>
				<if test="end != null">end=#{end},</if>
				<if test="state != null">state=#{state},</if>
				<if test="tags != null">tags=#{tags}</if>
			</set>
			where id=#{id}
		</update>
		
		<delete id="delete" parameterType="int">
			delete from projects
			where id=#{value}
		</delete>
	</mapper>