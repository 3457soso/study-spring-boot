<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<mapper namespace="dao.UserDao">
		<resultMap type="user" id="userResultMap">
			<id column="id" property="id"/>
			<result column="email" property="email"/>
			<result column="password" property="password"/>
			<result column="name" property="name"/>
			<result column="created_at" property="createdAt" javaType="java.sql.Date"/>
			<result column="updated_at" property="updatedAt" javaType="java.sql.Date"/>
		</resultMap>
		
		<select id="selectList" parameterType="map" resultMap="userResultMap">
			select id, email, name, created_at
			from users
			order by
			<choose>
				<when test="orderCond == 'EMAIL_ASC'">email ASC</when>
				<when test="orderCond == 'EMAIL_DESC'">email DESC</when>
				<when test="orderCond == 'NAME_ASC'">name ASC</when>
				<when test="orderCond == 'NAME_DESC'">name DESC</when>
				<when test="orderCond == 'CREDATE_DESC'">created_at DESC</when>
				<when test="orderCond == 'CREDATE_ASC'">created_at ASC</when>
				<when test="orderCond == 'ID_DESC'">id DESC</when>
				<otherwise>id ASC</otherwise>
			</choose>
		</select>
		
		<select id="exist" parameterType="map" resultMap="userResultMap">
			select id, email, name, created_at, updated_at
			from users
			where email=#{email} and password=#{password}
		</select>
		
		<select id="selectOne" parameterType="int" resultMap="userResultMap">
			select id, email, name, created_at, updated_at
			from users
			where id=#{value}
		</select>
		
		<insert id="insert" parameterType="map">
			insert into users(id, email, password, name, created_at, updated_at)
			values(null, #{email}, #{password}, #{name}, now(), now())
		</insert>
		
		<update id="update" parameterType="map">
			update users
			<set>
				<if test="name != null">name=#{name},</if>
				<if test="email != null">email=#{email},</if>
				updated_at=now()
			</set>
			where id=#{id}
		</update>
		
		<delete id="delete" parameterType="int">
			delete from users
			where id=#{value}
		</delete>
	</mapper>
